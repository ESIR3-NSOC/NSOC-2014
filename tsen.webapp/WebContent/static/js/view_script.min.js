function getData(){$.get("./view",function(e,t){$.each($.parseJSON(e),function(e,t){if(e=="zones"){zones=t}else if(e=="backgrounds"){backgrounds=t}else if(e=="viewSettings"){processSettings(t)}});refreshTable()})}function refreshTable(){if(tableBuilt)fillTable();else generateTable()}function processSettings(e){if(timer.isActive==null)timer.set({time:e["page_RefreshTime"],autostart:e["page_AutoRefresh"]});else if(timer.intervalTime!=e["page_RefreshTime"])timer.intervalTime=e["page_RefreshTime"];else if(timer.isActive!=e["page_AutoRefresh"])e["page_AutoRefresh"]?timer.play(true):timer.stop();if($("#table-title h3:first-child").text()!=e["ms1_WorldName"])$("#table-title h3:first-child").text(e["ms1_WorldName"])}function generateTable(){tableBuilt=false;$("div#table").empty().append($("<table>").addClass("table-fill"));$("table.table-fill").append($("<thead>").append($("<tr>").append($("<th>").addClass("form_container"))));$.each(zones,function(e,t){$("table.table-fill thead tr th.form_container").append($("<form>").attr({id:"form_zone_"+t["id"]}));$("table.table-fill thead tr").append($("<th>").addClass("text-center").addClass("zone_name").attr({zone_id:t["id"]}))});$("table.table-fill").append($("<tfoot>").append($("<tr>").append($("<td>"))));$.each(zones,function(e,t){var n=$("<td>").addClass("text-center").addClass("zone_settings").attr({zone_id:t["id"]});$(n).append($("<div>").addClass("zone_level").attr({lastval:"0"})).append("<br>");$(n).append($("<div>").addClass("level_value").text("0")).append("<br>");$(n).append($("<div>").addClass("button_container").append($("<input>").addClass("zone_mute button").attr({type:"submit",value:"Mute All"})).append($("<input>").addClass("zone_mute_background button").attr({type:"submit",value:"Mute BGM"})));$("table.table-fill tfoot tr").append($(n))});$("table.table-fill").append($("<tbody>"));$.each(backgrounds,function(e,t){var n=$("<tr>").attr({background_bundle:t["cobraNet"]["bundle"],background_channel:t["cobraNet"]["channel"]});$(n).append($("<td>").addClass("background_name"));$.each(zones,function(e,t){var r=$("<td>").addClass("text-center").attr({zone_id:t["id"]});$(r).append($("<div>").addClass("background_selector_container").append($("<input>").addClass("background_selector").attr({type:"checkbox",name:"select",value:"0",form:"form_zone_"+t["id"],disabled:""})).append("<span>"));$(n).append($(r))});$("table.table-fill tbody").append(n)});$(".zone_level").noUiSlider({start:0,orientation:"vertical",direction:"rtl",range:{min:0,max:100}});$(".zone_level").on({slide:function(){stopUpdate=true;if(parseInt($(this).val())<=parseInt($(this).attr("lastval"))-5||parseInt($(this).val())>=parseInt($(this).attr("lastval"))+5){$(this).attr({lastval:Math.round($(this).val())});$.post("./control",{control:"zoneVolumeLevel",level:Math.round($(this).val()),zoneid:$(this).parent().attr("zone_id")})}$(this).parent().find(".level_value").text(Math.round($(this).val()))},set:function(){$(this).attr({lastval:Math.round($(this).val())});$.post("./control",{control:"zoneVolumeLevel",level:Math.round($(this).val()),zoneid:$(this).parent().attr("zone_id")});stopUpdate=false}});$(".background_selector").change(function(){var e=$.zoneProp($(this));$.post("./control",{control:"zoneBackgroundSelection",zoneid:e.zoneID,inputid:$(this).attr("background_id")});e.zoneBackgroundSelectors().prop("checked",false);$(this).prop("checked",true);stopUpdate=false});$(".zone_mute").click(function(){var e=$.zoneProp($(this));$.post("./control",{control:"mute",zoneid:e.zoneID});e.setZoneLevelMuted(!e.isZoneMuted());e.setZoneMuted(!e.isZoneMuted());stopUpdate=false});$(".zone_mute_background").click(function(){var e=$.zoneProp($(this));$.post("./control",{control:"mutebackground",zoneid:e.zoneID});e.setZoneLevelBackgroundMuted(!e.isZoneBackgroundMuted());e.setZoneBackgroundMuted(!e.isZoneBackgroundMuted());stopUpdate=false});tableBuilt=true;fillTable()}function fillTable(){var e;$.each(backgrounds,function(t,n){e=$('tr[background_bundle="'+n["cobraNet"]["bundle"]+'"][background_channel="'+n["cobraNet"]["channel"]+'"] td.background_name');if(e.text()!=n["name"])e.text(n["name"])});$.each(zones,function(e,t){var n=$.zoneProp(t["id"]);n.getZoneName()!=t["name"]?n.setZoneName(t["name"]):false;n.getZoneLevel()!=t["level"]?n.setZoneLevel(t["level"]):false;n.isZoneMuted()!=t["muted"]?n.setZoneLevelMuted(t["muted"]):false;n.isZoneMuted()!=t["muted"]?n.setZoneMuted(t["muted"]):false;n.isZoneBackgroundMuted()!=t["backgroundMuted"]?n.setZoneLevelBackgroundMuted(t["backgroundMuted"]):false;n.isZoneBackgroundMuted()!=t["backgroundMuted"]?n.setZoneBackgroundMuted(t["backgroundMuted"]):false;!n.isZoneBackgroundSelectorChecked(t["cobraNet"]["bundle"],t["cobraNet"]["channel"])?n.zoneBackgroundSelectors().prop("checked",false):false;!n.isZoneBackgroundSelectorChecked(t["cobraNet"]["bundle"],t["cobraNet"]["channel"])?n.setZoneBackgroundSelectorChecked(t["cobraNet"]["bundle"],t["cobraNet"]["channel"],true):false;$.each(t["backgrounds"],function(e,n){var r=$.zoneProp(t["id"]);r.setZoneBackgroundSelectorDisabled(n["cobraNet"]["bundle"],n["cobraNet"]["channel"],false);r.zoneBackgroundSelector(n["cobraNet"]["bundle"],n["cobraNet"]["channel"]).attr("background_id",e)});if(Object.keys(t["backgrounds"]).length!=$('td[zone_id="'+t["id"]+'"] input[type="checkbox"][disabled!="disabled"]').length)tableBuilt=false});if(zones.length!=$("th.zone_name").length)tableBuilt=false;if(backgrounds.length!=$("td.background_name").length)tableBuilt=false}var zones;var backgrounds;var world_version=-1;var tableBuilt=false;var stopUpdate=false;(function(e){e.zoneProp=function(t){this.set=function(e){this.init=true;if(typeof e=="number"){this.zoneID=e}else if(typeof e=="object"){this.zoneID=e.closest("td").attr("zone_id")}else{this.init=false}return this};this.zoneName=function(){if(this.init)return e('th.zone_name[zone_id="'+this.zoneID+'"]')};this.getZoneName=function(){if(this.init)return this.zoneName().text()};this.setZoneName=function(e){if(this.init)return this.zoneName().text(e)};this.zoneBackgroundSelector=function(t,n){if(this.init)return e('tr[background_bundle="'+t+'"][background_channel="'+n+'"] td[zone_id="'+this.zoneID+'"] input.background_selector')};this.isZoneBackgroundSelectorChecked=function(e,t){if(this.init)return this.zoneBackgroundSelector(e,t).prop("checked")};this.isZoneBackgroundSelectorDisabled=function(e,t){if(this.init)return this.zoneBackgroundSelector(e,t).prop("disabled")};this.setZoneBackgroundSelectorChecked=function(e,t,n){if(this.init)this.zoneBackgroundSelector(e,t).prop("checked",n)};this.setZoneBackgroundSelectorDisabled=function(e,t,n){if(this.init)this.zoneBackgroundSelector(e,t).prop("disabled",n)};this.zoneBackgroundSelectors=function(){if(this.init)return e('td[zone_id="'+this.zoneID+'"] .background_selector ')};this.zoneLevel=function(){if(this.init)return e('td[zone_id="'+this.zoneID+'"] .zone_level ')};this.getZoneLevel=function(){if(this.init)return this.zoneLevel().val()};this.setZoneLevel=function(e){if(this.init)this.zoneLevel().val(e).attr({lastval:e}).parent().find(".level_value").text(e)};this.setZoneLevelMuted=function(e){if(this.init)e?this.zoneLevel().addClass("mutedAll"):this.zoneLevel().removeClass("mutedAll")};this.setZoneLevelBackgroundMuted=function(e){if(this.init)e?this.zoneLevel().addClass("mutedBGM"):this.zoneLevel().removeClass("mutedBGM")};this.zoneMute=function(){if(this.init)return e('td[zone_id="'+this.zoneID+'"] .zone_mute ')};this.isZoneMuted=function(){if(this.init)return this.zoneMute().attr("value")=="Unmute All"};this.setZoneMuted=function(e){if(this.init)e?this.zoneMute().attr("value","Unmute All").addClass("muted"):this.zoneMute().attr("value","Mute All").removeClass("muted")};this.zoneMuteBackground=function(){if(this.init)return e('td[zone_id="'+this.zoneID+'"] .zone_mute_background ')};this.isZoneBackgroundMuted=function(){if(this.init)return this.zoneMuteBackground().attr("value")=="Unmute BGM"};this.setZoneBackgroundMuted=function(e){if(this.init)e?this.zoneMuteBackground().attr("value","Unmute BGM").addClass("muted"):this.zoneMuteBackground().attr("value","Mute BGM").removeClass("muted")};if(this.init){return new e.zoneProp(t)}else{this.set(t);return this}}})(jQuery);(function($){$.timer=function(func,time,autostart){this.set=function(func,time,autostart){this.init=true;if(typeof func=="object"){var paramList=["autostart","time"];for(var arg in paramList){if(func[paramList[arg]]!=undefined){eval(paramList[arg]+" = func[paramList[arg]]")}}func=func.action}if(typeof func=="function"){this.action=func}if(!isNaN(time)){this.intervalTime=time}if(autostart&&!this.isActive){this.isActive=true;this.setTimer()}return this};this.play=function(e){if(!this.isActive){if(e){this.setTimer()}else{this.setTimer(this.remaining)}this.isActive=true}return this};this.stop=function(){this.isActive=false;this.remaining=this.intervalTime;this.clearTimer();return this};this.reset=function(){this.isActive=false;this.play(true);return this};this.clearTimer=function(){window.clearTimeout(this.timeoutObject)};this.setTimer=function(e){var t=this;if(typeof this.action!="function"){return}if(isNaN(e)){e=this.intervalTime}this.remaining=e;this.last=new Date;this.clearTimer();this.timeoutObject=window.setTimeout(function(){t.go()},e)};this.go=function(){if(this.isActive){this.action();this.setTimer()}};if(this.init){return new $.timer(func,time,autostart)}else{this.set(func,time,autostart);return this}}})(jQuery);var timer=$.timer(function(){if(!stopUpdate)getData()});getData()